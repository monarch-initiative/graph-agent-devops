####
#### Setup curategpt
####
---
- name: apt-get update && apt-get dist-upgrade
  apt: update_cache=yes upgrade=dist
- name: install main packages
  apt: pkg={{ item }} state=present
  with_items:
    - git
    - build-essential
    - python3-dev
    - python3-poetry
    - net-tools
    - pipx
    - unzip
    - byobu
- name: clear directory
  file:
    state: absent
    path: "/home/ubuntu/curategpt"
  become_user: "ubuntu"
- name: get the curategpt repo
  git: "repo=https://github.com/monarch-initiative/curategpt.git dest=/home/ubuntu/curategpt"
  become_user: "ubuntu"
- name: poetry install
  command: poetry install
  become_user: "ubuntu"
  args:
    chdir: "/home/ubuntu/curategpt"
- name: poetry install --all-extras
  command: poetry install --all-extras
  become_user: "ubuntu"
  args:
    chdir: "/home/ubuntu/curategpt"
# - name: pipx install paper-qa
#   command: pipx install paper-qa
- name: pipx install paper-qa
  command: pipx install paper-qa
  become_user: "ubuntu"
  args:
    chdir: "/home/ubuntu/curategpt"
- name: pipx ensurepath
  command: pipx ensurepath
  become_user: "ubuntu"
  args:
    chdir: "/home/ubuntu/curategpt"
